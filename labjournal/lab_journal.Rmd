---
author: Lisa Hu
output:
  pdf_document:
    includes:
      before_body: title.sty
    toc: true
    toc_depth: 1
    latex_engine: xelatex
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(pander)
library(dplyr)
```
\newpage
# Exploratory Data Analysis
For decompressing the data, run the code chunks in the Rmd file that deem fit for your situation:

* If you downloaded the data from the official site: Run coded chunks `decompress-data` and `create-dataset`.
* If you want to use the dataset delivered with the project: Run the `decompress-dataset` code chunk.

```{r decompress-data, eval=FALSE, echo=FALSE}
#' Use this code chunk to decompress the data downloaded from the site
#' Use the code chunk after this to create the dataset

## NOTE: Change the path to the data folder
file.names <- list.files("./Data")
sapply(file.names, FUN=function (file.name){
  system(paste("gzip -d", file.name))
})
```


```{r create-dataset, eval=FALSE, echo=FALSE}
#' Use this code chunk to load the different files into one dataset

## Function for reading in files to one dataset
read_sample <- function(file.name) {
  ## Extract the sample name for naming the column
  sample.name <- strsplit(file.name, ".", fixed = TRUE)
  sample.subject <- strsplit(sample.name[[1]][1], "_", fixed=TRUE)[[1]][2]
  colname <- paste0(sample.subject, "_", sample.name[[1]][2])
  ## Read the data, setting the 'Gene' as row.names (column 1)
  sample <- read.table(paste0("./Data/", file.name), sep="\t", row.names=NULL, header=TRUE,
                       col.names=c("Gene", colname))
  ## Return a subset containing the 'Gene' and sample name columns
  return(sample[c(1, 2)])
}

## Get the filenames of the data (NOTE: Change the path to the data folder)
file.names <- list.files("./Data")

## Read the FIRST sample
dataset <- read_sample(file.names[1])

## Read the rest of the sample group
for (file.name in file.names[2:48]) {
  sample <- read_sample(file.name)
  dataset <- merge(dataset, sample, by = 1)
}

## Exporting completed dataset to a file
write.table(dataset, file="./gene_count.txt", sep="\t", row.names=FALSE,
            col.names=TRUE, quote=FALSE)

## Now the dataset is ready to use
```


```{r decompress-dataset, eval=FALSE, echo=FALSE}
#' Decompress the complete dataset
#' Use this chunk if you did not download the data from the site and want to use
#'  the delivered gzipped dataset

## Set the count.file variable to the full path of the gene file
count.file <- ""
system(paste("gzip -d", count.file))
```

After decompressing the data, the data can be read:
```{r load-dataset}
## Read the dataset
dataset <- read.table("./gene_count.txt", sep="\t", header=TRUE)
## Indices for dataset
glucose.data <- seq(2, 47, 2)
galactose.data <- seq(3, 48, 2)

## Sample of the dataset
pander(dataset[0:5, 0:5])
```

To create a visual representation of the data, boxplots can be created:
```{r boxplots}
boxplot(log2(dataset[glucose.data]+1), main="Glucose", names=seq(1, 23),
        xlab="Sample", ylab="log2(Count)", outline=FALSE, cex.axis=0.6, cex.lab=0.8)
boxplot(log2(dataset[galactose.data]+1), main="Galactose", names=seq(1, 23),
        xlab="Sample", ylab="log2(Count)", outline=FALSE, cex.axis=0.6, cex.lab=0.8)
```


